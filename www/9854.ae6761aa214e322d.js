"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9854],{9854:(S,m,l)=>{l.r(m),l.d(m,{TicketsPageModule:()=>O});var d=l(6895),g=l(433),n=l(4556),p=l(131),u=l(655),o=l(7396),e=l(8256),T=l(3692),v=l(7556);let P=(()=>{class i{transform(t){return t.toDate().toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"})}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275pipe=e.Yjl({name:"timestampToDate",type:i,pure:!0}),i})();function k(i,c){if(1&i&&(e.TgZ(0,"p",10),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.userName)}}function A(i,c){if(1&i&&(e.TgZ(0,"p",10),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.rescuerName)}}function _(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"ion-select",11),e.NdJ("ionChange",function(a){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onSelectChange(a))}),e.TgZ(1,"ion-select-option",12),e._uU(2,"Pending"),e.qZA(),e.TgZ(3,"ion-select-option",4),e._uU(4,"Done"),e.qZA()()}if(2&i){const t=e.oxw().$implicit;e.s9C("id",t.id),e.Q6J("placeholder",t.status?t.status:"Pending")}}function Z(i,c){if(1&i&&(e.TgZ(0,"ion-item")(1,"ion-text"),e._uU(2),e.ALo(3,"timestampToDate"),e._UZ(4,"br"),e.TgZ(5,"ion-text"),e._uU(6),e.qZA(),e._UZ(7,"br"),e.YNc(8,k,2,1,"p",7),e.YNc(9,A,2,1,"ng-template",null,8,e.W1O),e.qZA(),e.YNc(11,_,5,2,"ion-select",9),e.qZA()),2&i){const t=c.$implicit,s=e.MAs(10),a=e.oxw();e.xp6(2),e.hij("",e.lcZ(3,5,t.dateSubmitted)," "),e.xp6(4),e.Oqu(t.emergencyType),e.xp6(2),e.Q6J("ngIf",a.isAdmin)("ngIfElse",s),e.xp6(3),e.Q6J("ngIf",a.isAdmin)}}const C=[{path:"",component:(()=>{class i{constructor(t,s,a,r){this.alertController=t,this.firebaseApp=s,this.auth=a,this.loadingController=r,this.isAdmin=!1,this.previousOption="pending",this.selectedStatus="Pending"}ngOnInit(){return(0,u.mG)(this,void 0,void 0,function*(){this.loading=yield this.loadingController.create({message:"Loading..."}),yield this.loading.present(),yield this.checkIfAdmin(),yield this.fetchTickets()})}fetchTickets(){return(0,u.mG)(this,void 0,void 0,function*(){const t=this.auth.getAuth.currentUser.uid;let s=(0,o.IO)((0,o.hJ)((0,o.ad)(this.firebaseApp),"Tickets"),(0,o.ar)("userId","==",t),(0,o.ar)("status","==",this.selectedStatus),(0,o.Xo)("dateSubmitted"));this.isAdmin&&(s=(0,o.IO)((0,o.hJ)((0,o.ad)(this.firebaseApp),"Tickets"),(0,o.ar)("rescuerId","==",t),(0,o.ar)("status","==",this.selectedStatus),(0,o.Xo)("dateSubmitted"))),(0,o.PL)(s).then(a=>{const r=a.docs.map(h=>{let f=h.data();return f.id=h.id,f});this.tickets=r,this.loading.dismiss()}).catch(a=>{console.error("Error fetching tickets:",a)})})}checkIfAdmin(){return(0,u.mG)(this,void 0,void 0,function*(){const t=(0,o.JU)((0,o.ad)(this.firebaseApp),"admins",this.auth.getAuth.currentUser.uid),s=yield(0,o.QT)(t);this.isAdmin=s.exists(),console.log(`isAdmin: ${this.isAdmin}`)})}onSelectChange(t){return(0,u.mG)(this,void 0,void 0,function*(){const s=t.detail.value,a=t.srcElement.id;console.log(a),s!==this.previousOption&&(console.log("Previous Option:",this.previousOption),yield(yield this.alertController.create({header:"Confirmation",message:"Are you sure you want to proceed to change status?",buttons:[{text:"No",role:"cancel",handler:()=>{t.target.value=this.previousOption}},{text:"Yes",handler:()=>(0,u.mG)(this,void 0,void 0,function*(){console.log("Selected value:",s),yield(0,o.pl)((0,o.JU)((0,o.ad)(this.firebaseApp),"Tickets",a),{status:t.target.value},{merge:!0}),this.previousOption=t.target.value})}]})).present())})}segmentChanged(t){return(0,u.mG)(this,void 0,void 0,function*(){this.selectedStatus=t.detail.value,yield this.fetchTickets(),console.log("Selected segment:",this.selectedStatus)})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(n.Br),e.Y36(T.Ot),e.Y36(v.e),e.Y36(n.HT))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-tickets"]],decls:21,vars:2,consts:[["slot","start"],["defaultHref","/"],["value","Pending",3,"ngModel","ionChange","ngModelChange"],["value","Pending","oncl",""],["value","Done"],["lines","full"],[4,"ngFor","ngForOf"],["class","new-line",4,"ngIf","ngIfElse"],["notAvailableText",""],["aria-label","Status","interface","popover",3,"id","placeholder","ionChange",4,"ngIf"],[1,"new-line"],["aria-label","Status","interface","popover",3,"id","placeholder","ionChange"],["value","Pending"]],template:function(t,s){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e._UZ(3,"ion-back-button",1),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5,"Rescue Tickets"),e.qZA()()(),e.TgZ(6,"ion-content")(7,"ion-card")(8,"ion-card-header")(9,"ion-card-title"),e._uU(10,"Your Tickets"),e.qZA(),e.TgZ(11,"ion-segment",2),e.NdJ("ionChange",function(r){return s.segmentChanged(r)})("ngModelChange",function(r){return s.selectedStatus=r}),e.TgZ(12,"ion-segment-button",3)(13,"ion-label"),e._uU(14,"Pending"),e.qZA()(),e.TgZ(15,"ion-segment-button",4)(16,"ion-label"),e._uU(17,"Logs"),e.qZA()()()(),e.TgZ(18,"ion-card-content")(19,"ion-list",5),e.YNc(20,Z,12,7,"ion-item",6),e.qZA()()()()),2&t&&(e.xp6(11),e.Q6J("ngModel",s.selectedStatus),e.xp6(9),e.Q6J("ngForOf",s.tickets))},dependencies:[d.sg,d.O5,g.JJ,g.On,n.oU,n.Sm,n.PM,n.FN,n.Zi,n.Dq,n.W2,n.Gu,n.Ie,n.Q$,n.q_,n.cJ,n.GO,n.t9,n.n0,n.yW,n.wd,n.sr,n.QI,n.cs,P],styles:["ion-title[_ngcontent-%COMP%], ion-card-title[_ngcontent-%COMP%]{color:#fff}.new-line[_ngcontent-%COMP%]{display:block;margin-top:1em}"]}),i})()}];let y=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[p.Bz.forChild(C),p.Bz]}),i})(),O=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[d.ez,g.u5,n.Pc,y]}),i})()}}]);