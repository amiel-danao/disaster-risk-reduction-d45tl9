"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5689],{5689:(J,c,r)=>{r.r(c),r.d(c,{LoginPageModule:()=>L});var m=r(6895),s=r(433),n=r(4556),u=r(131),h=r(655),l=r(7554),f=r(7423);const p=(0,f.fo)("Keyboard");var e=r(8256),y=r(7556),v=r(7323);function A(i,a){1&i&&(e.TgZ(0,"ion-note",13),e._uU(1,"Email is invalid"),e.qZA())}function P(i,a){1&i&&(e.TgZ(0,"ion-note",13),e._uU(1,"Password needs to be 6 characters"),e.qZA())}const b=[{path:"",component:(()=>{class i{constructor(o,t,g,d,U,Z,w,T){this.fb=o,this.loadingController=t,this.alertController=g,this.authService=d,this.router=U,this.menuCtrl=Z,this.firestore=w,this.auth=T,this.showOthers=!0,this.isRescuer=!1}get email(){return this.credentials.get("email")}get password(){return this.credentials.get("password")}ionViewWillEnter(){this.menuCtrl.enable(!1)}ngOnInit(){f.dV.isPluginAvailable("Keyboard")&&(p.addListener("keyboardDidShow",()=>{this.showOthers=!1}),p.addListener("keyboardDidHide",()=>{this.showOthers=!0})),this.credentials=this.fb.group({email:["",[s.kI.required,s.kI.email]],password:["",[s.kI.required,s.kI.minLength(6)]]}),null!=this.authService.getAuth.currentUser&&this.authService.logout()}register(){return(0,h.mG)(this,void 0,void 0,function*(){const o=yield this.loadingController.create();yield o.present();const t=yield this.authService.register(this.credentials.value);yield o.dismiss(),t?(this.isRescuer&&(yield(0,l.pl)((0,l.JU)(this.firestore,"admins",t.user.uid),{email:this.email.value},{merge:!0}),yield(0,l.pl)((0,l.JU)(this.firestore,"locations",t.user.uid),{isAdmin:!0},{merge:!0})),yield this.router.navigateByUrl("/home",{replaceUrl:!0})):yield this.showAlert("Registration failed","Please try again!")})}login(){return(0,h.mG)(this,void 0,void 0,function*(){const o=yield this.loadingController.create();yield o.present();const t=yield this.authService.login(this.credentials.value);if(yield o.dismiss(),t){const g=(0,l.JU)(this.firestore,"admins",this.auth.currentUser.uid);(yield(0,l.QT)(g)).exists()?this.isRescuer?(yield(0,l.pl)((0,l.JU)(this.firestore,"locations",this.auth.currentUser.uid),{isAdmin:!0},{merge:!0}),yield this.router.navigateByUrl("/home",{replaceUrl:!0})):(yield this.auth.signOut(),yield this.showAlert("Login failed","Not a rescuer")):this.isRescuer?(yield this.auth.signOut(),yield this.showAlert("Login failed","Not a rescuer")):yield this.router.navigateByUrl("/home",{replaceUrl:!0})}else yield this.showAlert("Login failed","Please try again!")})}showAlert(o,t){return(0,h.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:o,message:t,buttons:["OK"]})).present()})}onChange(o){this.isRescuer=o.target.checked}}return i.\u0275fac=function(o){return new(o||i)(e.Y36(s.qu),e.Y36(n.HT),e.Y36(n.Br),e.Y36(y.e),e.Y36(u.F0),e.Y36(n._q),e.Y36(l.gg),e.Y36(v.gx))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-login"]],decls:27,vars:8,consts:[[1,"ion-padding","page",3,"fullscreen","scrollEvents"],[3,"hidden"],["src","/assets/icon/favicon.png","alt","logo",1,"login-logo"],[3,"formGroup","ngSubmit"],["fill","solid",1,"ion-margin-bottom"],["type","email","placeholder","Email","formControlName","email"],["slot","error",4,"ngIf"],["type","password","placeholder","Password","formControlName","password"],["slot","start",3,"ionChange"],["type","submit","expand","block",3,"disabled"],["type","button","expand","block","color","secondary",3,"click"],[1,"ion-text-center"],[1,"login-subtitle"],["slot","error"]],template:function(o,t){1&o&&(e.TgZ(0,"ion-content",0)(1,"ion-grid")(2,"ion-row",1)(3,"ion-col"),e._UZ(4,"ion-img",2),e.qZA()(),e.TgZ(5,"ion-row")(6,"ion-col")(7,"form",3),e.NdJ("ngSubmit",function(){return t.login()}),e.TgZ(8,"ion-item",4),e._UZ(9,"ion-input",5),e.YNc(10,A,2,0,"ion-note",6),e.qZA(),e.TgZ(11,"ion-item",4),e._UZ(12,"ion-input",7),e.YNc(13,P,2,0,"ion-note",6),e.qZA(),e.TgZ(14,"ion-item")(15,"ion-checkbox",8),e.NdJ("ionChange",function(d){return t.onChange(d)}),e.qZA(),e.TgZ(16,"ion-label"),e._uU(17,"Check this, if you are a rescuer"),e.qZA()(),e.TgZ(18,"ion-button",9),e._uU(19,"Log in"),e.qZA(),e.TgZ(20,"ion-button",10),e.NdJ("click",function(){return t.register()}),e._uU(21,"Create account"),e.qZA()()()(),e.TgZ(22,"ion-row",1)(23,"ion-col")(24,"div",11)(25,"h3",12),e._uU(26,"HANDA AKO: NATURAL DISASTER AND RISK REDUCTION AND PREPAREDNESS"),e.qZA()()()()()()),2&o&&(e.Q6J("fullscreen",!0)("scrollEvents",!0),e.xp6(2),e.Q6J("hidden",!t.showOthers),e.xp6(5),e.Q6J("formGroup",t.credentials),e.xp6(3),e.Q6J("ngIf",(t.email.dirty||t.email.touched)&&t.email.errors),e.xp6(3),e.Q6J("ngIf",(t.password.dirty||t.password.touched)&&t.password.errors),e.xp6(5),e.Q6J("disabled",!t.credentials.valid),e.xp6(4),e.Q6J("hidden",!t.showOthers))},dependencies:[m.O5,s._Y,s.JJ,s.JL,n.YG,n.nz,n.wI,n.W2,n.jY,n.Xz,n.pK,n.Ie,n.Q$,n.uN,n.Nd,n.w,n.j9,s.sg,s.u],styles:[".page[_ngcontent-%COMP%]{--background: url(/assets/images/login_bg.png)}.login-subtitle[_ngcontent-%COMP%]{font-size:16px;line-height:26px;color:#000}.login-logo[_ngcontent-%COMP%]{width:60%;height:auto;margin-right:auto;margin-left:auto}ion-grid[_ngcontent-%COMP%]{height:100%}ion-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:30%}ion-checkbox[_ngcontent-%COMP%]{color:#fff}"]}),i})()}];let C=(()=>{class i{}return i.\u0275fac=function(o){return new(o||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[u.Bz.forChild(b),u.Bz]}),i})(),L=(()=>{class i{}return i.\u0275fac=function(o){return new(o||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[m.ez,s.u5,n.Pc,C,s.UX]}),i})()}}]);